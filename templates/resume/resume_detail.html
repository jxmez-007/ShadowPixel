{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Details - ShadowPixel</title>
    <meta name="description" content="View detailed resume information and AI analysis">
    
    {% load static %}
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'css/resume_detail.css' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Background Elements -->
    <div class="particle-field"></div>
    
    <!-- Navigation with Mobile Toggle -->
    <nav class="navigation" aria-label="Main navigation">
        <!-- Hamburger Toggle Button -->
        <button class="menu-toggle" aria-label="Toggle navigation" aria-expanded="false">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        
        <!-- Navigation Menu -->
        <ul class="nav-menu">
            <li><a href="{% url 'resume:index' %}">🏠 Home</a></li>
            <li><a href="{% url 'resume:upload_resume' %}">📤 Upload</a></li>
            <li><a href="{% url 'resume:uploaded_resumes' %}">📄 Resumes</a></li>
            <li><a href="{% url 'resume:statistics' %}">📊 Stats</a></li>
            <li><a href="{% url 'resume:help' %}">❓ Help</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>Resume Details</h1>
        
        {% if resume %}
            <div class="info-box">
                <h2>📋 Resume Information</h2>
                <p><strong>Resume ID:</strong> #{{ resume.pk }}</p>
                
                {% if resume.github_username %}
                    <p><strong>GitHub Profile:</strong> 
                        <a href="https://github.com/{{ resume.github_username }}" target="_blank" rel="noopener noreferrer" title="View GitHub Profile">
                            @{{ resume.github_username }}
                        </a>
                    </p>
                {% endif %}
                
                {% if resume.resume_file %}
                    <p><strong>Resume File:</strong> 
                        <a href="{{ resume.resume_file.url }}" target="_blank" rel="noopener noreferrer" title="Download Resume">
                            📎 {{ resume.original_filename|default:resume.resume_file.name }}
                        </a>
                    </p>
                {% endif %}
                
                <p><strong>Upload Date:</strong> {{ resume.created_at|date:"F d, Y \a\t H:i" }}</p>
                
                {% if resume.status %}
                    <p><strong>Status:</strong> 
                      <span class="status-{{ resume.status|lower }}">{{ resume.status|upper }}</span>
                    </p>
                {% endif %}
            </div>
            
            {% if resume.full_name or resume.email %}
            <div class="info-box">
                <h3>👤 Contact Information</h3>
                {% if resume.full_name %}
                    <p><strong>Full Name:</strong> {{ resume.full_name }}</p>
                {% endif %}
                {% if resume.email %}
                    <p><strong>Email Address:</strong> 
                        <a href="mailto:{{ resume.email }}" title="Send Email">
                            ✉️ {{ resume.email }}
                        </a>
                    </p>
                {% endif %}
                {% if resume.phone %}
                    <p><strong>Phone:</strong> {{ resume.phone }}</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- AI-Generated Summary Section -->
            <div class="info-box">
                <h3>🤖 AI-Generated Summary</h3>
                {% if resume.text_summary %}
                    <div class="summary-content">
                        <p>{{ resume.text_summary|linebreaks }}</p>
                        {% if ai_summary_available %}
                            <div style="margin-top: 10px;">
                                <span class="summary-badge">✨ Powered by AI</span>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="summary-placeholder">
                        <p style="margin: 0 0 15px 0;">📄 No AI summary available yet.</p>
                        {% if resume.status == 'completed' %}
                            <a href="{% url 'resume:reprocess_resume' resume.pk %}" class="btn btn-primary">
                                🚀 Generate AI Summary
                            </a>
                        {% elif resume.status == 'processing' %}
                            <span style="color: #ffc107;">⏳ Processing in progress...</span>
                        {% else %}
                            <span style="color: #dc3545;">⚠️ Resume processing incomplete</span>
                        {% endif %}
                    </div>
                {% endif %}
            </div>

            <!-- Extracted Text Section -->
            {% if resume.extracted_text %}
            <div class="info-box">
                <h3>📝 Extracted Content</h3>
                <div class="extracted-text-container">
                    <pre>{{ resume.extracted_text|truncatewords:100 }}</pre>
                    {% if resume.extracted_text|length > 500 %}
                        <p style="text-align: center; margin-top: 10px;">
                            <a href="{% url 'resume:resume_text' resume.pk %}" class="btn btn-secondary">
                                View Full Text
                            </a>
                        </p>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Skills Section -->
            {% if resume.skills %}
            <div class="info-box">
                <h3>💡 Skills</h3>
                <div class="skills-container">
                    {% for skill in resume.skills|split:"," %}
                        <span class="skill-badge">{{ skill|trim }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- GitHub Data Section -->
            {% if resume.github_data %}
            <div class="info-box">
                <h3>🐙 GitHub Information</h3>
                {% with resume.github_data.profile as profile %}
                    {% if profile.name %}
                        <p><strong>Name:</strong> {{ profile.name }}</p>
                    {% endif %}
                    {% if profile.bio %}
                        <p><strong>Bio:</strong> {{ profile.bio }}</p>
                    {% endif %}
                    {% if profile.public_repos %}
                        <p><strong>Public Repositories:</strong> {{ profile.public_repos }}</p>
                    {% endif %}
                    {% if profile.followers %}
                        <p><strong>Followers:</strong> {{ profile.followers }}</p>
                    {% endif %}
                {% endwith %}
                
                {% if resume.github_data.repositories %}
                    <h4 class="repo-heading">📚 Recent Repositories</h4>
                    <ul class="repo-list">
                        {% for repo in resume.github_data.repositories|slice:":5" %}
                            <li>
                                <strong>
                                    <a href="{{ repo.html_url }}" target="_blank">{{ repo.name }}</a>
                                </strong>
                                {% if repo.description %}
                                    <br><small>{{ repo.description|truncatewords:15 }}</small>
                                {% endif %}
                                {% if repo.language %}
                                    <br><span class="language-badge">{{ repo.language }}</span>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
            {% endif %}

            <!-- Processing Logs Section -->
            {% if processing_logs %}
            <div class="info-box">
                <h3>📊 Processing History</h3>
                <div class="processing-log">
                    {% for log in processing_logs %}
                        <div class="log-entry log-{{ log.status }}">
                            <strong>{{ log.step|title }}</strong>
                            <small>{{ log.created_at|date:"H:i:s" }}</small>
                            {% if log.message %}
                                <br><small>{{ log.message }}</small>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="info-box action-buttons">
                <h3>🔧 Actions</h3>
                <div class="button-grid">
                    {% if resume.status == 'completed' %}
                        <a href="{% url 'resume:reprocess_resume' resume.pk %}" class="btn btn-success">
                            🔄 Reprocess Resume
                        </a>
                    {% endif %}
                    
                    {% if resume.github_username %}
                        <a href="{% url 'resume:resume_github_sync' resume.pk %}" class="btn btn-purple">
                            🔄 Sync GitHub
                        </a>
                    {% endif %}
                    
                    {% if resume.resume_file %}
                        <a href="{% url 'resume:download_resume' resume.pk %}" class="btn btn-primary">
                            📥 Download File
                        </a>
                    {% endif %}
                    
                    <a href="{% url 'resume:delete_resume' resume.pk %}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this resume?')">
                        🗑️ Delete Resume
                    </a>
                </div>
            </div>
            
        {% else %}
            <div class="info-box error-box">
                <h2>❌ Resume Not Found</h2>
                <p>Sorry, no resume was found with ID: <strong>#{{ pk }}</strong></p>
                <p>The resume may have been deleted or the URL is incorrect.</p>
            </div>
        {% endif %}
        
        <div class="back-buttons">
            <a href="{% url 'resume:uploaded_resumes' %}" class="btn btn-secondary">← Back to Resume List</a>
            <a href="{% url 'resume:index' %}" class="btn btn-secondary">🏠 Home</a>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Generate particles
            const particleField = document.querySelector('.particle-field');
            if (particleField) {
                for(let i = 0; i < 15; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.position = 'fixed';
                    particle.style.top = `${Math.random() * 100}%`;
                    particle.style.left = `${Math.random() * 100}%`;
                    
                    const size = Math.random() * 6 + 2;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.background = '#007bff';
                    particle.style.borderRadius = '50%';
                    particle.style.animationDelay = `${Math.random() * 6}s`;
                    particle.style.animation = 'float 6s ease-in-out infinite';
                    particle.style.zIndex = '-1';
                    particle.style.opacity = '0.3';
                    
                    particleField.appendChild(particle);
                }
            }

            // Mobile Menu Toggle
            const menuToggle = document.querySelector('.menu-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            if (menuToggle && navMenu) {
                menuToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.setAttribute('aria-expanded', !isExpanded);
                    this.classList.toggle('active');
                    navMenu.classList.toggle('active');
                    
                    if (navMenu.classList.contains('active')) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                });
                
                const navLinks = navMenu.querySelectorAll('a');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        menuToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                        menuToggle.setAttribute('aria-expanded', 'false');
                        document.body.style.overflow = '';
                    });
                });
                
                document.addEventListener('click', function(event) {
                    const isClickInsideMenu = navMenu.contains(event.target);
                    const isClickOnToggle = menuToggle.contains(event.target);
                    
                    if (!isClickInsideMenu && !isClickOnToggle && navMenu.classList.contains('active')) {
                        menuToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                        menuToggle.setAttribute('aria-expanded', 'false');
                        document.body.style.overflow = '';
                    }
                });
                
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && navMenu.classList.contains('active')) {
                        menuToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                        menuToggle.setAttribute('aria-expanded', 'false');
                        document.body.style.overflow = '';
                    }
                });
            }

            // Animate info boxes on scroll
            const observeBoxes = () => {
                const boxes = document.querySelectorAll('.info-box');
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach((entry, index) => {
                        if (entry.isIntersecting) {
                            setTimeout(() => {
                                entry.target.style.opacity = '1';
                                entry.target.style.transform = 'translateY(0)';
                            }, index * 100);
                            observer.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                });
                
                boxes.forEach(box => {
                    box.style.opacity = '0';
                    box.style.transform = 'translateY(20px)';
                    box.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    observer.observe(box);
                });
            };
            
            observeBoxes();
        });

        // Particle animation keyframes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { 
                    transform: translateY(0px) translateX(0px) scale(1);
                    opacity: 0.3;
                }
                25% { 
                    transform: translateY(-30px) translateX(15px) scale(1.1);
                    opacity: 0.6;
                }
                50% { 
                    transform: translateY(-50px) translateX(-10px) scale(0.9);
                    opacity: 0.4;
                }
                75% { 
                    transform: translateY(-20px) translateX(20px) scale(1.05);
                    opacity: 0.7;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
